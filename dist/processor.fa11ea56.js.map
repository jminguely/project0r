{"version":3,"sources":["js/processor.js"],"names":["processor","timerCallback","video","paused","ended","computeFrame","self","setTimeout","doLoad","document","getElementById","image","c1","ctx1","getContext","c2","ctx2","c3","ctx3","addEventListener","width","videoWidth","height","videoHeight","drawImage","frame","getImageData","frameImage","l","data","length","zb","zf","putImageData","i","r","g","b","lum","x","y","parseInt","x_opposite","x_alpha","Math","atan","x_proj","floor","tan","y_opposite","y_alpha","y_proj","n"],"mappings":"AAAA,IAAIA,SAAS,GAAG;AACdC,EAAAA,aAAa,EAAE,yBAAY;AACzB,QAAI,KAAKC,KAAL,CAAWC,MAAX,IAAqB,KAAKD,KAAL,CAAWE,KAApC,EAA2C;AACzC;AACD;;AACD,SAAKC,YAAL;AACA,QAAIC,IAAI,GAAG,IAAX;AACAC,IAAAA,UAAU,CAAC,YAAY;AACrBD,MAAAA,IAAI,CAACL,aAAL;AACD,KAFS,EAEP,CAFO,CAAV;AAGD,GAVa;AAYdO,EAAAA,MAAM,EAAE,kBAAY;AAClB,SAAKN,KAAL,GAAaO,QAAQ,CAACC,cAAT,CAAwB,OAAxB,CAAb;AACA,SAAKC,KAAL,GAAaF,QAAQ,CAACC,cAAT,CAAwB,OAAxB,CAAb;AACA,SAAKE,EAAL,GAAUH,QAAQ,CAACC,cAAT,CAAwB,IAAxB,CAAV;AACA,SAAKG,IAAL,GAAY,KAAKD,EAAL,CAAQE,UAAR,CAAmB,IAAnB,CAAZ;AACA,SAAKC,EAAL,GAAUN,QAAQ,CAACC,cAAT,CAAwB,IAAxB,CAAV;AACA,SAAKM,IAAL,GAAY,KAAKD,EAAL,CAAQD,UAAR,CAAmB,IAAnB,CAAZ;AACA,SAAKG,EAAL,GAAUR,QAAQ,CAACC,cAAT,CAAwB,IAAxB,CAAV;AACA,SAAKQ,IAAL,GAAY,KAAKD,EAAL,CAAQH,UAAR,CAAmB,IAAnB,CAAZ;AACA,QAAIR,IAAI,GAAG,IAAX;AACA,SAAKJ,KAAL,CAAWiB,gBAAX,CACE,MADF,EAEE,YAAY;AACVb,MAAAA,IAAI,CAACc,KAAL,GAAad,IAAI,CAACJ,KAAL,CAAWmB,UAAxB;AACAf,MAAAA,IAAI,CAACgB,MAAL,GAAchB,IAAI,CAACJ,KAAL,CAAWqB,WAAzB;AACAjB,MAAAA,IAAI,CAACL,aAAL;AACD,KANH,EAOE,KAPF;AASD,GA/Ba;AAiCdI,EAAAA,YAAY,EAAE,wBAAY;AACxB,SAAKQ,IAAL,CAAUW,SAAV,CAAoB,KAAKtB,KAAzB,EAAgC,CAAhC,EAAmC,CAAnC,EAAsC,KAAKkB,KAA3C,EAAkD,KAAKE,MAAvD;AACA,SAAKN,IAAL,CAAUQ,SAAV,CAAoB,KAAKb,KAAzB,EAAgC,CAAhC,EAAmC,CAAnC,EAAsC,KAAKS,KAA3C,EAAkD,KAAKE,MAAvD;AAEA,QAAIG,KAAK,GAAG,KAAKZ,IAAL,CAAUa,YAAV,CAAuB,CAAvB,EAA0B,CAA1B,EAA6B,KAAKN,KAAlC,EAAyC,KAAKE,MAA9C,CAAZ;AACA,QAAIK,UAAU,GAAG,KAAKX,IAAL,CAAUU,YAAV,CAAuB,CAAvB,EAA0B,CAA1B,EAA6B,KAAKN,KAAlC,EAAyC,KAAKE,MAA9C,CAAjB;AAEA,QAAIM,CAAC,GAAGH,KAAK,CAACI,IAAN,CAAWC,MAAX,GAAoB,CAA5B;AAEA,QAAIC,EAAE,GAAG,GAAT;AACA,QAAIC,EAAE,GAAG,GAAT;AAEA,SAAKd,IAAL,CAAUe,YAAV,CAAuBN,UAAvB,EAAmC,CAAnC,EAAsC,CAAtC;;AAEA,SAAK,IAAIO,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGN,CAApB,EAAuBM,CAAC,EAAxB,EAA4B;AAC1B,UAAIC,CAAC,GAAGV,KAAK,CAACI,IAAN,CAAWK,CAAC,GAAG,CAAJ,GAAQ,CAAnB,CAAR;AACA,UAAIE,CAAC,GAAGX,KAAK,CAACI,IAAN,CAAWK,CAAC,GAAG,CAAJ,GAAQ,CAAnB,CAAR;AACA,UAAIG,CAAC,GAAGZ,KAAK,CAACI,IAAN,CAAWK,CAAC,GAAG,CAAJ,GAAQ,CAAnB,CAAR;AACA,UAAII,GAAG,GAAG,CAACF,CAAC,GAAGD,CAAJ,GAAQE,CAAT,IAAc,CAAxB;;AAEA,UAAIC,GAAG,GAAC,EAAR,EAAY;AAEV,YAAIC,CAAC,GAAGL,CAAC,GAAGM,CAAC,GAAGf,KAAK,CAACL,KAAtB;AACA,YAAIoB,CAAC,GAAGC,QAAQ,CAACP,CAAC,GAAGT,KAAK,CAACL,KAAX,EAAkB,EAAlB,CAAhB;AAEA,YAAIsB,UAAU,GAAGH,CAAC,GAAId,KAAK,CAACL,KAAN,GAAc,CAApC;AACA,YAAIuB,OAAO,GAAGC,IAAI,CAACC,IAAL,CAAUH,UAAU,IAAIV,EAAE,GAACM,GAAP,CAApB,CAAd;AACA,YAAIQ,MAAM,GAAGF,IAAI,CAACG,KAAL,CAAWH,IAAI,CAACI,GAAL,CAASL,OAAT,IAAoBZ,EAA/B,IAAsCN,KAAK,CAACL,KAAN,GAAc,CAAjE;AAEA,YAAI6B,UAAU,GAAGT,CAAC,GAAIf,KAAK,CAACH,MAAN,GAAe,CAArC;AACA,YAAI4B,OAAO,GAAGN,IAAI,CAACC,IAAL,CAAUI,UAAU,IAAIjB,EAAE,GAAGM,GAAT,CAApB,CAAd;AACA,YAAIa,MAAM,GAAGP,IAAI,CAACG,KAAL,CAAWH,IAAI,CAACI,GAAL,CAASE,OAAT,IAAoBnB,EAA/B,IAAsCN,KAAK,CAACH,MAAN,GAAe,CAAlE;AAEA,YAAI8B,CAAC,GAAGD,MAAM,GAAG1B,KAAK,CAACL,KAAf,GAAuB0B,MAA/B;AAEArB,QAAAA,KAAK,CAACI,IAAN,CAAWK,CAAC,GAAG,CAAJ,GAAQ,CAAnB,IAAwBP,UAAU,CAACE,IAAX,CAAgBuB,CAAC,GAAG,CAAJ,GAAQ,CAAxB,CAAxB;AACA3B,QAAAA,KAAK,CAACI,IAAN,CAAWK,CAAC,GAAG,CAAJ,GAAQ,CAAnB,IAAwBP,UAAU,CAACE,IAAX,CAAgBuB,CAAC,GAAG,CAAJ,GAAQ,CAAxB,CAAxB;AACA3B,QAAAA,KAAK,CAACI,IAAN,CAAWK,CAAC,GAAG,CAAJ,GAAQ,CAAnB,IAAwBP,UAAU,CAACE,IAAX,CAAgBuB,CAAC,GAAG,CAAJ,GAAQ,CAAxB,CAAxB,CAjBU,CAkBV;AACD,OAnBD,MAmBM;AACJ3B,QAAAA,KAAK,CAACI,IAAN,CAAWK,CAAC,GAAG,CAAJ,GAAQ,CAAnB,IAAwBP,UAAU,CAACE,IAAX,CAAgBK,CAAC,GAAG,CAAJ,GAAQ,CAAxB,CAAxB;AACAT,QAAAA,KAAK,CAACI,IAAN,CAAWK,CAAC,GAAG,CAAJ,GAAQ,CAAnB,IAAwBP,UAAU,CAACE,IAAX,CAAgBK,CAAC,GAAG,CAAJ,GAAQ,CAAxB,CAAxB;AACAT,QAAAA,KAAK,CAACI,IAAN,CAAWK,CAAC,GAAG,CAAJ,GAAQ,CAAnB,IAAwBP,UAAU,CAACE,IAAX,CAAgBK,CAAC,GAAG,CAAJ,GAAQ,CAAxB,CAAxB;AACD;AAEF;;AACD,SAAKhB,IAAL,CAAUe,YAAV,CAAuBR,KAAvB,EAA8B,CAA9B,EAAiC,CAAjC;AACA;AACD;AAjFa,CAAhB;AAoFAhB,QAAQ,CAACU,gBAAT,CAA0B,kBAA1B,EAA8C,YAAM;AAClDnB,EAAAA,SAAS,CAACQ,MAAV;AACD,CAFD","file":"processor.fa11ea56.js","sourceRoot":"../src","sourcesContent":["let processor = {\n  timerCallback: function () {\n    if (this.video.paused || this.video.ended) {\n      return;\n    }\n    this.computeFrame();\n    let self = this;\n    setTimeout(function () {\n      self.timerCallback();\n    }, 0);\n  },\n\n  doLoad: function () {\n    this.video = document.getElementById(\"video\");\n    this.image = document.getElementById(\"image\");\n    this.c1 = document.getElementById(\"c1\");\n    this.ctx1 = this.c1.getContext(\"2d\");\n    this.c2 = document.getElementById(\"c2\");\n    this.ctx2 = this.c2.getContext(\"2d\");\n    this.c3 = document.getElementById(\"c3\");\n    this.ctx3 = this.c3.getContext(\"2d\");\n    let self = this;\n    this.video.addEventListener(\n      \"play\",\n      function () {\n        self.width = self.video.videoWidth;\n        self.height = self.video.videoHeight;\n        self.timerCallback();\n      },\n      false\n    );\n  },\n\n  computeFrame: function () {\n    this.ctx1.drawImage(this.video, 0, 0, this.width, this.height);\n    this.ctx2.drawImage(this.image, 0, 0, this.width, this.height);\n\n    let frame = this.ctx1.getImageData(0, 0, this.width, this.height);\n    let frameImage = this.ctx2.getImageData(0, 0, this.width, this.height);\n\n    let l = frame.data.length / 4;\n\n    let zb = 960;\n    let zf = 480;\n\n    this.ctx3.putImageData(frameImage, 0, 0);\n\n    for (let i = 0; i < l; i++) {\n      let r = frame.data[i * 4 + 0];\n      let g = frame.data[i * 4 + 1];\n      let b = frame.data[i * 4 + 2];\n      let lum = (g + r + b) / 3;\n\n      if (lum>10) {\n\n        let x = i - y * frame.width;\n        let y = parseInt(i / frame.width, 10);\n\n        let x_opposite = x - (frame.width / 2);\n        let x_alpha = Math.atan(x_opposite / (zf+lum));\n        let x_proj = Math.floor(Math.tan(x_alpha) * zb) + (frame.width / 2);\n\n        let y_opposite = y - (frame.height / 2);\n        let y_alpha = Math.atan(y_opposite / (zf + lum));\n        let y_proj = Math.floor(Math.tan(y_alpha) * zb) + (frame.height / 2);\n\n        let n = y_proj * frame.width + x_proj;\n\n        frame.data[i * 4 + 0] = frameImage.data[n * 4 + 0];\n        frame.data[i * 4 + 1] = frameImage.data[n * 4 + 1];\n        frame.data[i * 4 + 2] = frameImage.data[n * 4 + 2];\n        // frame.data[i * 4 + 3] = (g + r + b) / 3;\n      }else {\n        frame.data[i * 4 + 0] = frameImage.data[i * 4 + 0];\n        frame.data[i * 4 + 1] = frameImage.data[i * 4 + 1];\n        frame.data[i * 4 + 2] = frameImage.data[i * 4 + 2];\n      }\n\n    }\n    this.ctx3.putImageData(frame, 0, 0);\n    return;\n  },\n};\n\ndocument.addEventListener(\"DOMContentLoaded\", () => {\n  processor.doLoad();\n});\n"]}